# テスト実施方法書

## 概要
本書は、タスク管理アプリケーションにおける各種テストの実施方法を定義します。単体テスト、統合テスト、品質チェック（Lint）の実行手順を記載しています。

## テスト環境構成

### 前提条件
- Docker及びDocker Composeがインストール済み
- Python 3.12以上（バックエンド）
- Node.js 20.0以上（フロントエンド）

### 環境準備
```bash
# プロジェクトルートに移動
cd /path/to/sample_claude-code

# Docker環境起動
docker-compose up -d

# 依存関係インストール（バックエンド）
cd app/backend
pip install -r requirements.txt

# 依存関係インストール（フロントエンド）
cd app/frontend
npm install
```

## バックエンドテスト

### 単体テスト実行

#### 1. 基本実行
```bash
cd app/backend

# 全テスト実行
pytest tests/ -v

# 特定テストファイル実行
pytest tests/test_tasks_api.py -v

# 特定テストクラス実行
pytest tests/test_tasks_api.py::TestTaskCreation -v

# 特定テストメソッド実行
pytest tests/test_tasks_api.py::TestTaskCreation::test_create_task_success -v
```

#### 2. カバレッジ付き実行
```bash
# カバレッジレポート生成
pytest tests/ --cov=app --cov-report=html --cov-report=term

# HTMLレポート確認（htmlcov/index.htmlが生成される）
```

#### 3. 並列実行（高速化）
```bash
# pytest-xdistを使用した並列実行
pip install pytest-xdist
pytest tests/ -n auto
```

### テスト設定

#### テスト環境変数
```bash
# .env設定（テスト用）
DATABASE_URL=sqlite:///./test.db
PYTHONPATH=/app
DEBUG=True
```

#### テストデータベース
- SQLiteをテスト用DBとして使用
- 各テスト実行前にDBクリア・再作成
- 本番用PostgreSQLとは分離

### テスト結果の確認
- 成功：`PASSED` 表示
- 失敗：`FAILED` 表示、詳細エラー出力
- 警告：Pydantic v2非推奨警告は無視可能

## フロントエンドテスト

### 単体テスト実行

#### 1. 基本実行
```bash
cd app/frontend

# 全テスト実行
npm test

# ウォッチモード（開発時）
npm run test:watch

# カバレッジ付き実行
npm run test:coverage
```

#### 2. テスト設定
```bash
# TypeScriptタイプチェック
npm run typecheck

# TypeScriptタイプチェック
npm run typecheck
```

### フロントエンドテストツール
- **Jest**: JavaScriptテストフレームワーク
- **Testing Library**: React コンポーネントテスト
- **jsdom**: DOM環境シミュレーション
- **ts-jest**: TypeScript サポート

### テストファイル構成
```
app/frontend/
├── app/
│   ├── components/
│   │   └── __tests__/          # コンポーネントテスト
│   ├── routes/
│   │   └── __tests__/          # ルートテスト
│   └── lib/
│       └── __tests__/          # ユーティリティテスト
└── tests/
    ├── integration/            # 統合テスト
    └── e2e/                   # E2Eテスト
```

## 品質チェック（Lint）

### バックエンド品質チェック

#### 1. Python コードフォーマット
```bash
cd app/backend

# Black（フォーマッター）
pip install black
black . --check                 # チェックのみ
black .                        # 自動修正

# isort（インポート整理）
pip install isort
isort . --check-only           # チェックのみ
isort .                        # 自動修正
```

#### 2. Python コード品質チェック
```bash
# flake8（構文・スタイルチェック）
pip install flake8
flake8 app/ tests/

# mypy（型チェック）
pip install mypy
mypy app/

# pylint（詳細品質チェック）
pip install pylint
pylint app/
```

### フロントエンド品質チェック

#### 1. TypeScript チェック
```bash
cd app/frontend

# TypeScript コンパイラチェック
npm run typecheck

# TypeScriptタイプ生成
npx tsc --noEmit
```

#### 2. ESLint・Prettier
```bash
# ESLint（コード品質チェック）
npx eslint app/ --ext .ts,.tsx,.js,.jsx

# Prettier（フォーマットチェック）
npx prettier --check app/

# 自動修正
npx eslint app/ --fix
npx prettier --write app/
```

## 統合テスト

### API統合テスト
```bash
# プロジェクトルートで実行
cd /path/to/sample_claude-code

# 統合テストスクリプト実行
python integration_test.py

# Docker環境での統合テスト
docker-compose exec backend pytest tests/test_integration.py
docker-compose exec frontend npm run test:integration
```

### E2Eテスト（将来実装）
```bash
# Playwright使用想定
cd app/frontend
npx playwright test

# Cypress使用想定
npx cypress run
```

## CI/CD環境でのテスト実行

### GitHub Actions想定
```yaml
# .github/workflows/backend.yml
- name: Run Backend Tests
  run: |
    cd app/backend
    pip install -r requirements.txt
    pytest tests/ --cov=app --cov-report=xml

# .github/workflows/frontend.yml  
- name: Run Frontend Tests
  run: |
    cd app/frontend
    npm install
    npm run test:coverage
    npm run typecheck
```

## テスト結果の評価基準

### 成功基準
- **単体テスト**: 100% PASSED
- **カバレッジ**: 80%以上
- **型チェック**: エラー0件
- **Lint**: 重要度High以上のエラー0件

### 失敗時の対応
1. テスト失敗の原因特定
2. コード修正
3. 再テスト実行
4. 成功まで繰り返し

## トラブルシューティング

### よくある問題

#### バックエンド
- **ModuleNotFoundError**: PYTHONPATH設定確認
- **Database error**: test.db削除後再実行
- **Import error**: 仮想環境の依存関係確認

#### フロントエンド  
- **Module not found**: npm install再実行
- **Type error**: npx react-router typegen実行
- **Jest timeout**: --maxWorkers=1 オプション追加

### デバッグコマンド
```bash
# 詳細ログ出力
pytest tests/ -v -s

# 特定テストのみ実行
pytest tests/test_tasks_api.py::test_create_task_success -v -s

# ブレークポイント使用
pytest tests/ --pdb
```

## 定期実行推奨

### 開発時
- コミット前: 単体テスト + Lint
- プッシュ前: 全テスト実行

### CI/CD
- プルリクエスト時: 全テスト + カバレッジ
- マージ時: 統合テスト + E2Eテスト
- デプロイ前: 全テスト + パフォーマンステスト